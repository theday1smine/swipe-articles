<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0">
    <title>Hypothesis Demo</title>
    
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
    
    
    
    <style>
      body {
        min-height: 100vh;
      }
      header {
        min-height: 10vh;
        background-color: dodgerblue;
      }
      
      main {
        background: #cdcdee;
        min-height: 80vh;

        transition: all .3s;
      }
      .is-open main {
/*        transform: translateX(360px);*/
      }
      
      footer {
        background: dodgerblue;
        min-height: 10vh;
      }
      
/*
      .hypothesis-col {
        display: flex;
        flex-direction: column;
        align-content: stretch;
      }
*/
      
      /* Create styles for wrapper */
      .hypothesis-container {
        position: sticky;
        top: 0;
        height: 100vh;
        width: 100%;
      }
      .hypothesis-container .h-sidebar-iframe {
        /* Stuff found in default stylesheet */
        margin: 0;
        margin-left: 0px;
        padding: 0;
        border: 0;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        background: #cdcdee;
        direction: ltr;
        background: none;
        font-size: 14px;
        line-height: 20px;
        z-index: 2147483647;
        
        /* Custom stuff for demo */
/*        box-shadow: 0 0 25px rgba(0,0,0,0.2);*/
        border: 0;
        height: 100%;
        width: 100%;
        
        border: 1px solid rgba(0,0,0,.1);
      }
      
      .annotator-hl,
      body.annotator-highlights-always-on .annotator-hl {
        background-color: rgba(0, 255, 10, .8);
      }
      body.annotator-highlights-always-on .annotator-hl.annotator-hl-focused {
        background-color: rgba(0, 255, 10, 1);
      }
    </style>
  </head>
  
  <body class="d-flex flex-column align-items-stretch">
    
    <header>

    </header>
    
    <main>
      <div class="container-fluid">
        <h1 class="my-5">Hypothesis Demo</h1>
        
        <div class="row">
          <div class="col-6">
            <h2>Colonne 1</h2>
            
            <hr>
            
            <p>
              Ce bouton (grâce à l’attribut <code>data-hypothesis-trigger</code>) peut <strong>ouvrir</strong> le panneau hypothesis, mais non le <em>fermer</em>. <em>(inutile ici car le panneau n'est pas caché)</em>
            </p>
            
            <p>
              <button data-hypothesis-trigger
                      class="btn btn-success">Ouvrir</button>
            </p>
            
            <p>
              L'attribut <code>data-hypothesis-annotation-count</code> permet d'afficher le nombre d'annotations.
            </p>

            <div class="card">
              <div class="card-body">
                Nombre total d'annotations : <strong data-hypothesis-annotation-count>(chargement…)</strong>
              </div>
            </div>
            <br>

            <p>Mi ut rutrum praesent habitasse habitasse eget parturient mus semper sit mus ridiculus varius a tristique sem leo odio non augue ullamcorper id adipiscing vestibulum ut. Diam convallis mus a placerat vestibulum himenaeos condimentum sit fusce egestas habitant id sed lectus elementum proin lacus class pulvinar nullam enim nisi a justo vel. Mi nascetur purus lobortis eleifend id euismod a aptent a est suspendisse natoque vestibulum a vestibulum nascetur a. Posuere interdum habitasse a netus justo parturient himenaeos venenatis donec a ullamcorper nunc scelerisque justo mauris at a suspendisse mus montes ante porttitor.</p>

            <p>Vitae condimentum dui cubilia felis sapien parturient parturient parturient suspendisse nulla fusce elementum magna rhoncus adipiscing parturient gravida consectetur justo scelerisque parturient ut tristique. Ad a vestibulum a blandit velit rutrum habitasse parturient nisl venenatis a mus vestibulum parturient a vestibulum nam scelerisque a condimentum posuere parturient dictum. Egestas fusce consectetur parturient dui vel a adipiscing inceptos ut dis sociis platea est vitae volutpat cras maecenas parturient nulla risus. Laoreet nunc a conubia primis scelerisque a pharetra adipiscing faucibus bibendum mattis cursus aenean convallis himenaeos montes at a venenatis quisque adipiscing vestibulum potenti massa vestibulum a.</p>

            <p>Eu habitasse senectus sodales venenatis neque varius velit eleifend sed mus et neque a vitae parturient parturient gravida etiam a ullamcorper. A cum parturient hendrerit ut ullamcorper fermentum a scelerisque a magna magnis velit enim orci ut a a. Id proin vulputate habitasse magna euismod cras a ut porta scelerisque a per nec a a condimentum mus parturient cum eu. Vitae vivamus bibendum libero proin massa id felis mattis orci auctor curae scelerisque dignissim sit a ornare fringilla mattis a parturient parturient sem dictumst sit parturient scelerisque. Himenaeos varius a egestas vestibulum sodales ante a metus vestibulum nisi feugiat dis himenaeos molestie erat ullamcorper parturient aliquet himenaeos parturient adipiscing lectus. Magnis et hac vestibulum dapibus adipiscing adipiscing consectetur facilisis mattis a sed per facilisis vestibulum luctus.</p>

            <p>Eu cras leo torquent imperdiet mauris justo vestibulum vestibulum a convallis faucibus platea inceptos condimentum condimentum condimentum etiam cum velit consectetur praesent arcu in vestibulum hendrerit consectetur. Tempor eu at parturient nisi ut arcu vestibulum integer nunc est leo scelerisque maecenas conubia ad eu lacus adipiscing per. Justo habitasse consectetur ac scelerisque parturient a sapien suspendisse nascetur lacus adipiscing sed pharetra adipiscing sed suspendisse sem natoque viverra purus rhoncus ad penatibus. Consectetur ante iaculis mauris lectus parturient bibendum purus porttitor leo aliquet adipiscing nostra posuere tempus. A urna posuere a urna ut a a mattis scelerisque montes massa sem fames orci praesent nec mus eleifend rutrum molestie enim ac ut vestibulum.</p>

            <p>Mollis et amet tempus condimentum parturient tempor egestas ullamcorper enim parturient nostra cursus parturient sed sed elit mus at habitasse arcu mus a ullamcorper a diam condimentum sed convallis. Parturient vestibulum egestas a arcu a dapibus a ante ad ligula faucibus tincidunt montes neque. Eu aliquam adipiscing lacinia faucibus non parturient a malesuada metus penatibus diam consectetur suspendisse hac consectetur integer a nostra euismod iaculis. Ridiculus in venenatis ullamcorper a a varius eu consequat phasellus non lacinia vivamus ultricies lobortis in vestibulum taciti senectus magnis curae interdum sed. Suspendisse dictumst ullamcorper laoreet rhoncus turpis curabitur parturient feugiat parturient mauris semper cum adipiscing sociosqu convallis gravida ullamcorper ut quis at condimentum eros. Vivamus proin eu adipiscing parturient mi vestibulum et pulvinar adipiscing class vestibulum vestibulum scelerisque nisl dui suspendisse mollis.</p>
          
          </div>
          
          <div class="col-6 hypothesis-col">
            <div class="hypothesis-container">
            <!-- hypothesis will be placed here -->
            </div>
          </div>
        </div>
      </div>
    </main>
    
    <footer>
    </footer>
    
    <script>
      const bodyElem = document.querySelector('body');
      window.hypothesisConfig = function () {
        return {
          onLayoutChange: function (info) {
            if (info.expanded) {
              bodyElem.classList.add('is-open');
            } else {
              bodyElem.classList.remove('is-open');
            }
          },
          externalContainerSelector: '.hypothesis-container',
          
          branding: {
            accentColor: '#00ff00',
            appBackgroundColor: '#cdcdee',
            ctaBackgroundColor: '#4455ee',
            ctaTextColor: '#ffffee',
            selectionFontFamily: 'Garamond, serif',
            annotationFontFamily: 'Courier, monospace' 
          }
        }
      }
    </script>
    <script src="https://hypothes.is/embed.js" async></script>
    
    <script>
      // we're looking for an element `.annotator-frame`
      var hypothesisElemSelector = '.annotator-frame';
      document.addEventListener('DOMContentLoaded', function () {
        
      });
      
      function listenForHypothesis() {
        // Select the node that will be observed for mutations
        const targetNode = document.querySelector(hypothesisElemSelector);

        // Options for the observer (which mutations to observe)
        const config = { attributes: true, childList: false, subtree: false };

        // Callback function to execute when mutations are observed
        const callback = function(mutationsList, observer) {
          for(let mutation of mutationsList) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
              console.log('The ' + mutation.attributeName + ' attribute was modified.');

              if (targetNode.classList.contains('annotator-collapsed')) {
                bodyElem.classList.remove('is-open');
                console.log('Collapsed!')
              } else {
                console.log('Open!');
                // check if we should open
                bodyElem.classList.add('is-open');
              }
            }
          }
        };

        // Create an observer instance linked to the callback function
        const observer = new MutationObserver(callback);

        // Start observing the target node for configured mutations
        observer.observe(targetNode, config);
        
      }
      
      function initHypothesisWatcher() {
        var timer;
        
        if (!document.querySelector(hypothesisElemSelector)) {
          console.log('Did not find hypothesis; retrying in 1 second.');
          // cancel timer and retry
          if (timer) {
            window.clearTimeout(timer);
          }
          timer = window.setTimeout(function () {
            initHypothesisWatcher();
          }, 1000);
        } else {
          console.log('Found hypothesis! :D')
          // kill timers
          if (timer) {
            window.clearTimeout(timer);
          }
          // ready, lanch the listner
          listenForHypothesis();
        }
      }
      
      
    </script>
  </body>
</html>
